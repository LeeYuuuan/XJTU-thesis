% !TeX root = ../main.tex

\xchapter{用于脑卒中快速鉴别的生成式EIT图像重建实验}{The Experiment of EIT Reconstruction for Fast Detection of Stroke}
在上一章中，我们通过EIDORS生成的仿真数据对本文提出的生成式EIT图像重建网络进行了训练和评估，验证了该模型能显著提高EIT图像重建结果的重建分辨率。
本章将在该模型的基础上，通过实验验证该模型用于脑卒中快速鉴别的可行性以及其算法的优势，同时对该算法的不足之处进行优化。
此外，本章还会对训练集的生成进行了研究，并且根据研究结果优化了网络结构。



\xsection{用于脑卒中快速鉴别的生成式EIT图像重建物理实验}{The Physical Experiment of EIT Reconstruction for Fast Detection of Stroke}

\xsubsection{实验方案}{Experiment Scheme and Design}

用于脑卒中快速鉴别的生成式EIT图像重建算法的物理实验流程如下图所示。其中包括EIT成像目设计与制作，EIT采集系统设计与搭建，利用扰动目标和EIT采集系统获得数据以及根据测量数据评估重建算法四个步骤。
本节将重点介绍EIT成像目标的设计与制作以及EIT采集系统的设计与搭建部分。

\xsubsection{EIT成像目标的设计与制作}{Design and Manufacture of EIT Imaging Target}
\label{ImageingTarget}
EIT成像目标包括背景帧以及扰动目标，本节将首先介绍扰动目标的制作流程，随后将阐述背景帧的制作流程。

由于脑卒中可被分为缺血性卒中和失血性卒中，缺血性卒中由于其病灶区域血液（水）含量较少，因此其对应的电导率较低。
而失血性卒中由于其病灶区域大量出血，因此其对应的电导率通常较高。
琼脂是亲水性胶体，在一定温度条件下，向琼脂溶液中加入一定量的电介质即可使其具有特定的电导率。
因此本实验将用琼脂和氯化钠以及水制作出具有不同电导率的琼脂快，来代表不同类型卒中的病灶区域。
本实验将采用2个不同的电导率值作为扰动目标的电导率分布，其分别为0.5S/m 和 0.05S/m。
根据多次试验得，在出每100g水，1.5g琼脂粉的条件下，其琼脂快的电导率$\sigma$(S/m)与氯化钠的含量$x$(g)可用\cref{equation:NACL}近似拟合。
\begin{equation}
    \centering
    \label{equation:NACL}
    \sigma = 2.008x + 0.0207
\end{equation}

此外，本实验用于盛放琼脂并使其凝固的容器为如图所示底面直径不同的陶瓷容器，其底面直径分别为5cm,4cm和2.5cm。
故本所所制作的扰动目标的详细参数如\cref{table:target}所示。

\begin{table}
    \centering
    \caption{扰动目标的参数}
    \begin{tblr}{colspec = {X[c] X[c] X[c] X[c]}}
        \toprule
        编号 & 电导率(S/m) & 底面直径(cm) & 每100g水所需的氯化钠含量(g)\\
        \midrule
        1 & 0.05 & 5 & 0.02 \\
        2 & 0.05 & 4 & 0.02 \\
        3 & 0.05 & 2.5 & 0.02 \\
        4 & 0.5 & 5 & 0.23 \\
        5 & 0.5 & 4 & 0.23 \\
        6 & 0.5 & 2.5 & 0.23 \\
        \bottomrule
    \end{tblr}
    \label{table:target}
\end{table}


具体步骤如\cref{figure:experiment}，即：
1） 用电子秤称取1.5g的琼脂粉。
2） 将称好的琼脂粉倒入烧杯中。
3） 像烧杯中加入100ml的蒸馏水，并将其与琼脂粉冲分混合。
4） 再利用电子秤称取一定量的氯化钠粉末。
5） 将称取的氯化钠粉末倒入琼脂溶液中。
6） 利用高温加热炉，将上述混合溶液加热至沸腾，并在加热的过程中冲分搅拌使其溶解（根据实测在常压下需要保持270摄氏度左右）。
7） 将充分溶解的溶液倒入尺寸不同的陶瓷容器中，静置2小时待其凝固。
8） 将凝固的琼脂快取出备用。


以上过程为EIT物理模型中扰动目标的制作方式，上述两种扰动目标将分别代表两类卒中的病灶区域。本实验将用硫酸钙溶液来模拟颅内的正常脑组织，作为病灶区域的背景帧溶液。
由于电介质的溶解率受到温度、压强、震动等外在因素影响显著，而溶液的电导率对电介质含量非常敏感，因此本实验将利用饱和硫酸钙溶液作为背景帧，以将制作过程中产生的误差降到最低，从而使得仿真过程中使用到的背景电导率与物理实验的背景电导率在最大程度上保持一致。
具体而言，在常温（20-24摄氏度）常压（一个标准大气压），将硫酸钙粉末不断加入到大量纯净水中，静置并等待其完全溶解。重复上述步骤，直到硫酸钙不再溶解，后静置24小时后获得常温常压下稳定的饱和硫酸钙溶液。
将溶液倒入EIT采集系统的丙烯酸玻璃器皿中，静置24小时待其稳定后方可使用。
此外，由于扰动目标与背景溶液接触时，不可避免的会发生离子交换，从而产生误差。因此，为了将这部分误差降至最低，本实验将制作3批作为背景电导率的饱和硫酸钙溶液，每使用6个琼脂块进行成像后将更换背景溶液，从而尽可能得减少背景溶液的电导率的变化。



\begin{figure}[H]
    \centering
    \includegraphics[width=.8\textwidth]{experiment.png}
    \caption{EIT扰动目标制作流程}
    \label{figure:experiment}
\end{figure}

随后利用阻抗分析仪（如\cref{figure:zukangfenxiyi}）测量上述扰动目标的电导率，验证其电导率的准确性。

\begin{figure}[H]
    \centering
    \includegraphics[width=.8\textwidth]{zukangfenxiyi.JPG}
    \caption{阻抗分析仪}
    \label{figure:zukangfenxiyi}
\end{figure}

本实验中，为了更好的区分不同电导率的扰动目标，用黄色琼脂块表示电导率为0.5S/m的扰动目标
，而用蓝色琼脂块表示电导率为0.05S/m的扰动目标。如\cref{figure:QiongZhiKuai}所示


\begin{figure}[h]
    \centering

    \includegraphics[width=.7\textwidth]{QiongZhiKuai.png}
    \caption{琼脂块制作示意图}
    \label{figure:QiongZhiKuai}
\end{figure}


\xsubsection{EIT采集系统设计与搭建}{Design and Construction of EIT Measurment System}
EIT采集系统通常包括激励测量硬件系统、电极与导联系统，以及用于控制激励测量过程、分析和保存数据的软件系统。
本实验采用标准的16电极圆形物理模型容器(16 phantom tank)作为待测场，如\cref{figure:Phantom}所示。该水槽的外直径为20cm，内直径为19.4cm，其高度为15cm，材质为丙烯酸玻璃。
该模型共包含16个电极，其材质均为不锈钢A2，切16个电极位于同一平面上，每个电极之间的距离相等。其与电缆连接的部分为香蕉插头，材质均为不锈钢。

电缆为标准的EIT测量电缆集，如\cref{figure:CableSet}所示，其长度为1m，连接类型均为香蕉插头。

测量仪器采用Sciospec Scientific Instruments公司所生产的16通道EIT系统。本实验所采用的的电极激励模式为邻近激励，即单次测量电流的输入和输出分别为1号电极和2号电极，2号电极和3号电极，以此类推，共16次激励。
每次电流激励下该系统将分别测量16个电极的电位，故单次测量所获得的的电位向量为256维。另外，本实验所测得的数据是在单频激励下所得到的，其激励电流的频率为50khz，
激励电流的强度0.0005A。每秒采样的次数为1帧（即该系统理论上每秒向PC输出1组测量电位）。

\begin{figure}
    \centering
    \includegraphics[width=.6\textwidth]{Phantom.png}
    \caption{EIT待测场设置}
    \label{figure:Phantom}
\end{figure}

\begin{figure}
    \centering
    \includegraphics[width=.6\textwidth]{CableSet.png}
    \caption{EIT连接电缆图示}
    \label{figure:CableSet}
\end{figure}

最后将扰动目标放入其待测场内，即可制作完成用于测量的电导率分布未知场。如\cref{figure:raodongmubiao}所示。
\begin{figure}[H]
    \centering
    \includegraphics[width=.5\textwidth]{raodongmubiao.jpg}
    \caption{待测场图示}
    \label{figure:raodongmubiao}
\end{figure}


\xsection{实验过程}{Experimental Process}
本节将具体的阐述整个物理实验进行的过程。实验共分为两个主要部分。其中，第一部分将利用电导率为0.05S/m的琼脂块作为扰动目标，即\cref{ImageingTarget}中编号为1-3的琼脂块。
分别测量其在物理容器中三个不同位置下的电位数据。
第二部分则是利用电导率为0.5S/m的琼脂块作为扰动目标（\cref{ImageingTarget}中编号为4-6的琼脂块），分别测量其在第一部分中三个位置下的电位数据。

具体开展流程如下：

首先按照\cref{ImageingTarget}中的步骤和具体参数制作电导率为0.05S/m的琼脂块3个。
随后进行实验的第一测量采集。
为防止琼脂块在空气中水分子的流失导致其形变，进而影响其放置在水槽中的稳定性，第二次测量采集需要重新制作电导率为0.5S/m的琼脂块3个，制作好后立即展开第二部分实验。

第一部分其具体流程为：

     1）静置好的物理容器连接EIT采集系统，并将EIT采集系统连接至PC，随后通过其串口设置好电流强度、激励频率、激励模式等参数（见上一节），打开EIT采集系统。
     2）静置1分钟后再，等待20秒，记录20帧背景帧的电位数据的编号信息。
     3）向硫酸给溶液中位置1处放置1号扰动目标，静置1分钟后记录采集到的20帧电位数据的编号。
     4）将1号扰动目标移动至位置2，静置1分钟后记录采集到的的20帧电位数据的编号。
     5）将1号扰动目标移动至位置3，重复上述步骤。
     6）将1号扰动目标取出，将2号、3号扰动目标分别放置于上述三个位置上，并重复静置、记录的步骤。
     7）将扰动目标取出，关闭EIT设备。


第二部分对扰动目标为0.5S/m的三个琼脂块开展与第一部分流程相同的实验。至此已获得初步的物理实验数据待后续使用。

随后，本文对上述测得的电位数据进行了分析。由于EIT采集设备所得到的电位向量为测量电极相对于0电位点的电位差，该分布与本文所提出的差分EIT重建算法重建目标不同，故还需要对采集到的数据进行处理，如\cref{figure:eeeee}。

具体操作如下：
该设备采集到的EIT数据共包含16次相邻激励的每个电极所采集到的电位值，该值为一个复数，包含了实部和虚部。而EIT图像重建任务的重建目标（电导率分布）仅和电位的实部相关，因此首先去掉所有电位数据的虚部。
第二，通常EIT所采用的电压信号为两个电极之间的电位差，而本文所采用的电压测量模式为邻近测量，其测量值与仿真数据的电压分布有如 \cref{table:measU} 的映射方式。
\begin{table}
    \centering
    \caption{测量电位的转换方式}
    \begin{tblr}{colspec = {X[c] X[c] X[c] }}
        \toprule
        EIT仿真模型中单次测量所得的向量的下标  & EIT采集系统所得到的与该电压值相关的测量值下标 & 利用测量值获得对应的仿真数据方式\\
        \midrule
        0 & 0,1 & $v_0 - v_1$ \\
        1 & 1,2 & $v_1 - v_2$ \\
        2 & 2,3 & $v_2 - v_3$ \\
        3 & 3,4 & $v_3 - v_4$ \\
        4 & 4,5 & $v_4 - v_5$ \\
        5 & 5,6 & $v_5 - v_6$ \\
        6 & 6,7 & $v_6 - v_7$ \\
        7 & 7,8 & $v_7 - v_8$ \\
        8 & 8,9 & $v_8 - v_9$ \\
        9 & 9,10 & $v_9 - v_{10}$ \\
        10 & 10,11 & $v_{10} - v_{11}$ \\
        11 & 11,12 & $v_{11} - v_{12}$ \\
        12 & 12,13 & $v_{12} - v_{13}$ \\
        13 & 13,14 & $v_{13} - v_{14}$ \\
        14 & 14,15 & $v_{14} - v_{15}$ \\
        15 & 15,0 & $v_{15} - v_{0}$ \\
        
        \bottomrule
    \end{tblr}
    \label{table:measU}
\end{table}

按照上述方式将测得的电位数据映射为重建算法所需要的邻近测量模式的数据，并利用本文所提出的生成式EIT图像重建算法对其内部电导率分布进行重建，
即可获得重建结果。
此外，由于EIT采集系统所采用的采集帧率为每秒1帧，故本文将对每个扰动目标放入物理模型且稳定后静置1分钟，获得60帧数据。
随后在其中随机选择20帧，计算所选数据每个通道上的平均值，利用该值作为最终用于成像的电压数据，以此减小其由于水面波动以及其他外界因素导致的误差。
\xsection{实验结果与分析}{Experiment Results}

本节利用上述采集到的的电压数据分别从其重建图像分辨率、以及时间性能评估了上一章中所提出的图像重建算法，分别阐述了该算法的优势和不足。
随后改进了上一章中电压编码器VEncoder，进一步优化了该重建算法的性能。
最后还对数据集的选择做出了详细的分析，提高了该模型的训练效率。

\xsubsection{图像重建质量分析}{Analysis of Quality of Reconstructed Image}

上述实验已获得2个不同电导率分布（分别为0.05S/m和0.5S/m）的扰动目标分别在饱和硫酸钙溶液中3个不同位置下的电位向量（每个向量包含256个元素）。

其中重建结果如\cref{figure:Reconsresexp}所示。
\begin{figure}[h]
    \centering
    \includegraphics[width=.7\textwidth]{Reconsresexp.PNG}
    \caption{EIT物理实验结果}
    \label{figure:Reconsresexp}
\end{figure}


根据以上结果可以看出：

     1）本文所提出的算法可以有效区分不同电导率下的扰动目标，即可以实现对不同类型的卒中进行快速鉴别。
     2）该算法可以有效对场域中不同位置的扰动目标成像。（传统EIT图像重建算法对接近场域中心的扰动目标成像效果差）。
     3）该算法对尺寸较小的扰动目标的成像分辨率不如尺寸较大的扰动目标。


据分析，上述第3条结果可能的原因如下：由于该扰动目标的尺寸较小，同时采集到的数据包含大量噪声，因此该采集结果中信噪比较低，
同时训练集的并没有直接包含该尺寸的扰动目标，故使得该网络无法对该类型的扰动目标准确地提取特征并成像。
此外，但通过结论可以发现，本文所提出的算法对与原先数据分布有很大差异的电压数据其中有关电导率分布值的特征提取能力较强。
即准确地展现出了该扰动目标的电导率分布，这一定程度上体现出该算法的在对扰动目标电导率分布值的拟合的泛化能力较强。
因此可有效地区分出不同电导率分布的扰动目标，进而应用在对于脑卒中快速鉴别的任务中。

\xsubsection{时间性能分析}{Analysis of Time Performance}

由于基于深度学习的EIT图像重建算法在图像重建的过程中只需要执行一次网络的正向推理，因此该类算法相较于传统基于迭代的EIT图像重建算法有显著的时间性能优势。
由于两类算法的实现平台不同，以下比较具有一定的局限性，但其单次的计算时间具有多个数量级的差距，故仍可得出上述结论。

以32次重建为一组（与网络的batch数目相同）传统的N-R方法需要3.3941s（基于Matlab 2022实现， 操作系统环境：Windows 10）。
而利用本文所提出的EIT图像重建算法仅需要0.1877s（运算环境：python 3.10.12， Torch 2.2.1+cu121，GPU：Tesla 4 15360MiB，cuda 12.2, V12.2.140）。
故该算法具有明显的时间性能优势。

然而该算法的网络训练过程仍然非常耗时，其各模块训练时长共计约40小时。分析网络结构可得，
除了必要的模块外，VEncoder模块中的全连接网络大大降低了该算法的运行效率以及空间利用率，因此本节将会对该模块进行优化。

VEncoder的目标是对EIT电压数据进行编码，使得编码后的结果尽可能表达出更强有关于该电压数据所对应的电导率分布的特征。
而CNN对于高维数据的空间特征提取能力具有显著的优势。同时，CNN也相较于MLP而言具有更少的可学习参数。因此，此节以CNN为主体，利用径向基函数神经网络（Radial Basis Function Neural Network）
替代了FCN层，从而实现了一个RBF-CNN 以替代原来的VEncoder。其结构如\cref{figure:RBFCNN}所示。
\begin{figure}[h]
    \centering
    \includegraphics[width=.5\textwidth]{RBFCNN.png}
    \caption{RBFCNN结构}
    \label{figure:RBFCNN}
\end{figure}

为验证该RBF-CNN对于EIT数据优秀的拟合能力，本节利用该网络实现一个EIT逆问题求解器。只要该网络能重建出明显高质量的EIT图像，则证明该网络可以提取出能表达EIT电压数据有关其对应的电导率分布的特征。

首先利用仿真模型获得EIT电压-电导率分布数据集，
其中，$d_m =  576$ ，即剖分的单元个数为576。$d_v = 192$ 即测量电压向量为192维。背景电导率为$0.15S/m$，扰动目标的中心电导率为0.7S/m。
大小为六边形，且其电导率根据距中心的距离而减小，如\cref{figure:RBF_cond}所示。
\begin{figure}[h]
    \centering
    \includegraphics[width=.5\textwidth]{RBF_cond.png}
    \caption{EIT仿真结果}
    \label{figure:RBF_cond}
\end{figure}

由于卷积层输出的每个元素都包含原始数据的空间特征，因此输出层包含 512 个神经元，代表更深层次的特征。
此后为一个径向基函数神经网络（RBFNN），输入层有512个神经元，输出层有576个神经元，分别代表每个元素的电导率。
众所周知，多层感知器包含点积（输入和权重之间）和激活（非线性）函数（例如 ReLU、Sigmoid 函数）。
网络训练通常是通过所有层的反向传播来完成的。
与 MLP 不同，RBFNN 使用欧几里德距离（输入和权重之间，也称为中心）和高斯激活函数，这使得神经元更加局部敏感。 
RBF 网络具有与 MLP 类似的输入层和输出层。
不同的是，隐藏层中的每个神经元都有一个原型向量和一个由 $\mu$ 和 $sigma$ 表示的带宽分别计算输入向量与其原型向量之间的相似度，如\cref{equation:RBFNN}所示。
\begin{equation}
    \label{equation:RBFNN}
    y(x) = f(z(x)) = \sum_{i=1}^{m} v_i \phi_i(z(x)) + b
\end{equation}
其中：
\begin{equation}
    \phi_i(z(x)) = \exp\left(-\frac{|x - \mu_i|^2}{2\sigma_i^2}\right)
\end{equation}

$y(x)$ 是 RBFNN 的输出；
$f(\cdot)$ 是输出层的激活函数；$z(x)$ 是隐含层的输出；
$\phi_i(z(x))$ 是隐含层神经元 $i$ 的激活函数；
$v_i$ 是连接隐含层和输出层的权重；
$b$ 是偏置项；
$m$ 是隐含层神经元的数量。

该网络首先包含 192 个神经元的输入层，分别对应于边界电压的每个维度。接下来有 6 个卷积层，每一步应用 3 × 3 卷积核和最大池化。最后两层应用 3×3 卷积核和 2×2 卷积核平均池，在每个卷积层之后使用指数线性单元（ELU）作为激活函数，因为 ELU 是。
由于卷积层输出的每个元素都包含原始数据的空间特征，因此输出层包含 512 个神经元，代表更深层次的特征。

利用训练数据初步重建模型，所得的结果如\cref{figure:recons_rbf}所示，其中，
第一行中的第一张图像是真实值。另外两个分别采用NR方法和学习率=0.0005模型的CNN + RBFNN（Adam）重建。
第二行的前两张图像由 CNN+ RBFNN (Adam) 重建，学习率 = 0.0001 和 0.001。第三个则则是由单独的CNN（Adam）重建。
\begin{figure}[H]
    \centering
    
    \includegraphics[width=.7\textwidth]{recons_rbf.png}
    \label{figure:recons_rbf}
    \caption{重建结果对比}
\end{figure}

\cref{table:RBFNNev}为对该网络性能的评估，其中RE和CC分别为相对误差(relative error)和 相关系数(correlation coefficient)。
(表中仅为最佳学习率下的性能)
\begin{table}[H]
    \centering
    \caption{网络评估}
    \label{table:RBFNNev}
    \begin{tblr}{colspec={X[c] X[c] X[c] X[c]}}
        \toprule
        模型类型 & 学习率 & CC & RE($\times 10^{-5}$) \\
        \midrule
        CNN+RBF(Adam) & 0.0005 & 0.9595 & 5.0552 \\ 
        CNN+RBF(SGDM) & 0.8& 0.9020 & 7.2939 \\
        CNN(Adam) & 0.0005 & 0.3694 & 15.0147 \\
        \bottomrule
    \end{tblr}
\end{table}

通过相对误差和重建结果可分析得出，带有RBFNN的重建结果相较于不带RBFNN的重建结果有显著提升，
因此认为RBFNN对于EIT电压-电导率映射的拟合有显著作用。
此外，adam优化器对EIT重建结果具有显著的提升。




111

111


111
此外，由于EIT图像重建算法固有的病态性，即微小的电压变化就会对重建结果产生巨大的影响，因此本文设计了一个去噪声网络，该网络结构与\cref{RBF}所提出的网络架构基本一致，
不同的是将网络的输出层用一个全连接的网络替代，使得输出结果为一个256维的向量，用于表示该真实电压分布所对应的电压仿真结果，起到了去噪声的效果。
该网络用于拟合真实测量的电压分布到仿真的电压分布的映射，用于对测得的电压分布进行去噪。

具体而言，利用采集到的数据帧进行邻近测量的差分处理后，同时利用同样电导率分布的仿真模型经过EIT正向计算获得电压向量，
利用两个电压向量作为训练数据。其中，仿真的电压数据作为网络的预期输出，而测量所得到的电压数据作为网络的输入数据。
该数据集共包含2000条数据，随后按照训练集-测试集8：2的方式进行划分，由此所得到的去噪网络的

利用该去噪网络，本文对电导率为0.05S/m，底面直径为2.5cm的的扰动目标重新进行了成像，所得到的的结果如\cref{figure:resgood}
\begin{figure}[h]
    \centering
    \includegraphics[width=.5\textwidth]{resgood.png}
    \caption{经过电压去噪声后的重建结果}
    \label{figure:resgood}
\end{figure}

可以看到，经过电压去噪网络后，该算法能有效地重建出小目标的电导率分布。
故在实际的应用中，可以首先针对不同的EIT采集设备设计适用于其的电压去噪声网络，随后去噪后的EIT电压数据进行图像重建任务，
即可最大程度上减少由于测量电压分布于真实电压分布不同而导致的图像重建质量差的问题。

\xsubsection{小结}{Summary}

本章利用本文所提出的生成式EIT图像重建算法，并根据脑卒中的类别设计物理实验，制作了不同的扰目标来验证该算法应用在脑卒中快速鉴别任务上的优势。
随后实现了对于不同电导率分布的扰动目标的图像重建任务。实验结果表明，该算法能有效区分不同电导率的扰动目标，即该算法可用于不同类型的脑卒中快速鉴别任务很中。
此外，本章还设计的一个电压去噪声网络，通过拟合测量电压到仿真电压的映射，从而使得该算法能更有效地重建出小目标的电导率分布。
